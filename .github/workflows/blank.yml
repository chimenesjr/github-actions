name: Pull Request Validation

on:
  pull_request:

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:

  validate:
    runs-on: ubuntu-latest

    steps:
      - name: Validating branch name
        shell: bash
        run: | 
          echo ${GITHUB_REF##*/}
      - name: Validating branch name
        shell: bash
        run: | 
          echo Testing branch name: ${GITHUB_REF##*/}

          project1="SWISCO-"
          project2="SWISCA-"
          ticket_number="([1-9]|[1-9][0-9]|[1-9][0-9][0-9]|[1-9][0-9][0-9][0-9])"
          if [[ ! "${GITHUB_REF##*/}" =~ $project1$ticket_number && ! "${GITHUB_REF##*/}" =~ $project2$ticket_number ]]; then
            echo "Branch name should contain JIRA ticket, like..."
            echo " SWISCO-1234-short-description"
            echo " feature/SWISCO-1234-short-description"
            echo " release/SWISCA-1234-short-description"
            exit 1
          fi
      - name: Validating title
        shell: bash
        run: | 
          echo Testing title: ${{ github.event.pull_request.title }}
      - name: force-fail
        shell: bash
        run: | 
          echo Force fail
          if [[ 1 == 1 ]]; then
            echo "Force fail"
            exit 1
          fi
